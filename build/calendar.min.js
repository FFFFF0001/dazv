!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Dazv=t.Dazv||{})}(this,function(t){"use strict";function e(t){var e="undefined"==typeof t?"undefined":x(t);return"function"===e||!!t&&"object"==e}function i(t){return"[object Array]"===H.call(t)}function o(t){return"object"===("undefined"==typeof t?"undefined":x(t))&&"number"==typeof t.nodeType&&"object"===x(t.ownerDocument)}function n(t){return!!S[H.call(t)]}function r(t){if(null==t||"object"!=("undefined"==typeof t?"undefined":x(t)))return t;var e=t,i=H.call(t);if("[object Array]"===i){e=[];for(var n=0,a=t.length;n<a;n++)e[n]=r(t[n])}else if(b[i])e=t.constructor.from(t);else if(!S[i]&&!o(t)){e={};for(var h in t)t.hasOwnProperty(h)&&(e[h]=r(t[h]))}return e}function a(t,h,s){if(!e(h)||!e(t))return s?r(h):t;for(var l in h)if(h.hasOwnProperty(l)){var c=t[l],d=h[l];!e(d)||!e(c)||i(d)||i(c)||o(d)||o(c)||n(d)||n(c)?!s&&l in t||(t[l]=r(h[l],!0)):a(c,d,s)}return t}function h(t){var e={};return t=t||"v",e[t]?e[t]+=1:e[t]=1,t+e[t]}function s(){return document.createElement("div")}function l(t){var e,i=t.id,o=document.getElementById(i);if(!o&&!e)throw new Error("please specify the canvas container Id !");if(o&&e)throw new Error('please specify the "container" or "id" property !');if(!e){var n=k.guid("v-chart");t.container=e=k.createDiv(),e.id=n,e.style.position="relative",o.appendChild(e)}return e}function c(t){this.width=t.width,this.height=t.height,this.containerDOM=t.container,this.fontFamily=t.fontFamily,this.init()}function d(t){var e=t.margin;this.start={x:e[3],y:e[0]},this.end={x:t.width-e[1],y:t.height-e[2]},this.width=this.end.x-this.start.x,this.height=this.end.y-this.start.y}function f(t){t=t||{},this.gradient=t.gradient||{.1:"#fe0000",.4:"#ffaa01",.7:"#b0e000",1:"#38a702"},this.width=t.width||1,this.height=t.height||256,this.min=t.min||0,this.max=t.max||300,this.init()}function y(t){this.options=t,this.splitList=t.splitList||{},this.type=t.type||"continuous",this.calculable=t.calculable,this.init()}function p(t,e){this.options=t,this.init(e)}function g(t,e,i,o,n){this.i=t,this.x=e,this.y=i,this.w=o,this.h=n}function m(t,e){this.opts=t,this.viewWidth=e.width,this.viewHeight=e.height,this.start=e.start,this.end=e.end,this.init()}function v(t,e){this.opts=e,this.container=t,this.style=e.style,this.isShow=e.isShow,this.triggerOn=e.triggerOn,this.create()}function u(t,e){var i=new c({width:t.width,height:t.height,container:t.container,fontFamily:t.fontFamily});return e&&i.addTopLeft(),i}function w(t){t=t||{},this.options=k.merge(W,t,!0),this.init()}var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},b={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},H=Object.prototype.toString,k={merge:a,guid:h,createDiv:s},W={width:1e3,height:500,fontSize:12,fontFamily:'"Helvetica Neue",Helvetica,"Hiragino Sans GB","STHeitiSC-LIght","Microsoft YaHei","微软雅黑",Arial,sans-serif',viewCfg:{margin:[20,60,60,60]},axisCfg:{line:{lineWidth:1,stroke:"#ccc",fill:"#f1f1f1"},labels:{fontSize:12,fill:"#3c3c3c"},title:{fontSize:12,fill:"#999"},tickLine:{lineWidth:1,stroke:"#ccc",value:5},titleOffset:42,lableOffset:10,grid:{line:{lineWidth:1,stroke:"#d9d9d9"}},gridAlign:"start",x:{type:"date",name:"日期（day）",min:0,max:31,showLine:!1,tickInterval:1},y:{type:"month",name:"月份（month）",min:0,max:12,showLine:!1,tickInterval:1},rows:12,cols:31,space:0,isIntersect:!0},calendarCfg:{rows:3,cols:4,margin:[0,10,8,0],monthStyle:{height:21,fontSize:12,fontWeight:"bold",fill:"#F4F4F4",color:"#3c3c3c"},weekStyle:{height:21,fontSize:12,fill:"#fff",color:"#666"},dayStyle:{fontSize:12,lineWidth:.1,stroke:"#ccc",color:"#3c3c3c"},itemStyle:{stroke:"#eee",fill:"#f1f1f1",lineWidth:1}},legendCfg:{show:!0,type:"piecewise",min:0,max:300,width:13,height:180,textGap:10,selectedMode:"multiple",itemSymbol:"circle",itemWidth:20,itemHeight:10,itemGap:14,wordSpaceing:8,left:15,bottom:5,calculable:!0,textStyle:{fontSize:12,color:"#3c3c3c"},gradient:{.1:"#fe0000",.2:"#ff3801",.3:"#ff7300",.4:"#ffaa01",.5:"#fae200",.6:"#e5f500",.7:"#b0e000",.8:"#84cf00",.9:"#5aba00",1:"#38a702"},splitList:[{start:0,end:50,color:"#00E400",level:"优"},{start:50,end:100,color:"#FFFF00",level:"良"},{start:100,end:150,color:"#FF7E00",level:"轻度污染"},{start:150,end:200,color:"#FF0000",level:"中度污染"},{start:200,end:300,color:"#99004C",level:"重度污染"},{start:300,color:"#7E0023",level:"严重污染"}]},toolTip:{isShow:!0,position:[5,5],triggerOn:"mousemove",style:"position:absolute;visibility:hidden;background-Color:rgba(0,0,0,0.7);transition:top 0.2s,left 0.2s;border-radius: 2px;color:#fff;line-height: 16px;padding:5px 10px;"}};c.prototype.init=function(){var t=this.containerDOM.childNodes.length,e=document.createElement("canvas"),i=e.getContext("2d");e.id="canvas_"+(t+1),e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.containerDOM.appendChild(e),this.canvasDOM=e,i.fontFamily=this.fontFamily,this.context=i},c.prototype.addTopLeft=function(){var t=this.canvasDOM;t.style.position="absolute",t.style.top=0,t.style.left=0},f.prototype.init=function(){var t=this.gradient,e=document.createElement("canvas");e.width=this.width,e.height=this.height;var i=this.context=e.getContext("2d"),o=i.createLinearGradient(0,0,e.width,e.height);for(var n in t)o.addColorStop(parseFloat(n),t[n]);i.fillStyle=o,i.fillRect(0,0,e.width,e.height)},f.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},f.prototype.getColor=function(t){var e=this.max;t>e&&(e=t);var i=4*Math.floor((e-t)/e*(this.height-1)),o=this.context.getImageData(0,0,1,this.height).data;return"rgba("+o[i]+", "+o[i+1]+", "+o[i+2]+", 1)"},y.prototype.init=function(){if("piecewise"==this.type&&this.calculable)for(var t=new f(this.options),e=this.splitList,i=0;i<e.length;i++)e[i].color=t.getColor(e[i].start)},y.prototype.get=function(t){for(var e=this.splitList,i=!1,o=0;o<e.length;o++)if((void 0===e[o].start||void 0!==e[o].start&&t>e[o].start)&&(void 0===e[o].end||void 0!==e[o].end&&t<=e[o].end)){i=e[o];break}return i},p.prototype.init=function(t){var e=this.options;this.start={x:t.end.x+e.left,y:t.end.y-e.bottom-e.height-e.textGap},this.end={x:t.end.x+e.left+e.width,y:t.end.y-e.bottom-e.textGap}},p.prototype.draw=function(t){if(this.options.show)switch(this.options.type){case"piecewise":this.drawByPieceWise(t);break;default:this.drawByContinuous(t)}},p.prototype.drawByContinuous=function(t){var e=this.options,i=new f({width:e.width,height:e.height,min:e.min,max:e.max,gradient:e.gradient});t.putImageData(i.getImageData(),this.start.x,this.start.y),t.save(),t.font=e.textStyle.fontSize+"px "+t.fontFamily,t.fillStyle=e.textStyle.color,t.textAlign="center",t.textBaseline="middle",t.fillText(e.max,this.start.x+e.width/2,this.start.y-e.textGap),t.fillText(e.min,this.start.x+e.width/2,this.end.y+e.textGap),t.restore()},p.prototype.drawByPieceWise=function(t){new y(this.options);switch(this.options.itemSymbol){case"circle":this.drawCircle(t);break;case"rect":this.drawRect(t);break;case"roundRect":this.drawRoundRect(t)}},p.prototype.drawCircle=function(t){for(var e=this.options,i=e.itemHeight/2,o=0;o<e.splitList.length;o++){var n=e.splitList[o],r=this.start.x+i,a=this.end.y-e.itemHeight*o-e.itemGap*o-i;t.fillStyle=n.color,t.beginPath(),t.arc(r,a,i,0,2*Math.PI,!0),t.closePath(),t.fill(),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+t.fontFamily,t.fillStyle=e.textStyle.color,t.fillText(n.level,r+i+e.wordSpaceing,a),t.restore()}},p.prototype.drawRect=function(t){for(var e=this.options,i=e.itemHeight/2,o=0;o<e.splitList.length;o++){var n=e.splitList[o],r=this.start.x,a=this.end.y-e.itemHeight*(o+1)-e.itemGap*o;t.fillStyle=n.color,t.fillRect(r,a,e.itemWidth,e.itemHeight),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+t.fontFamily,t.fillStyle=e.textStyle.color,t.fillText(n.level,r+e.itemWidth+e.wordSpaceing,a+i),t.restore()}},p.prototype.drawRoundRect=function(t){for(var e=this.options,i=e.itemHeight/2,o=3,n=0;n<e.splitList.length;n++){var r=e.splitList[n],a=this.start.x,h=this.end.y-e.itemHeight*(n+1)-e.itemGap*n;t.fillStyle=r.color,t.beginPath(),t.moveTo(a+o,h),t.arcTo(a+e.itemWidth,h,a+e.itemWidth,h+e.itemHeight,o),t.arcTo(a+e.itemWidth,h+e.itemHeight,a,h+e.itemHeight,o),t.arcTo(a,h+e.itemHeight,a,h,o),t.arcTo(a,h,a+o,h,o),t.closePath(),t.fill(),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+t.fontFamily,t.fillStyle=e.textStyle.color,t.fillText(r.level,a+e.itemWidth+e.wordSpaceing,h+i),t.restore()}},m.prototype.init=function(){var t=this.opts;this.weeks=["日","一","二","三","四","五","六"],this.boxWidth=this.viewWidth/this.opts.cols,this.boxHeight=this.viewHeight/this.opts.rows,this.width=this.boxWidth-t.margin[1],this.height=this.boxHeight-t.margin[2],this.monthHeight=t.monthStyle.height,this.weekWidth=this.dayWidth=this.width/this.weeks.length,this.weekHeight=t.weekStyle.height,this.dayHeight=(this.height-this.monthHeight-this.weekHeight)/6,this.axisData=[]},m.prototype.drawCalendar=function(t,e,i,o){var n=this,r=n.opts;t.textAlign="center",t.textBaseline="middle",t.beginPath(),t.save(),t.fillStyle=r.monthStyle.fill,t.fillRect(o.x,o.y,n.width,n.monthHeight),t.restore(),t.save(),t.font=r.monthStyle.fontWeight+" "+r.monthStyle.fontSize+"px "+t.fontFamily,t.fillStyle=r.monthStyle.color,t.fillText(e+"年"+i+"月",o.x+n.width/2,o.y+n.monthHeight/2),t.restore(),t.closePath(),t.save(),t.fillStyle=r.weekStyle.fill,t.fillRect(o.x,o.y+n.monthHeight,n.width,n.weekHeight),t.restore(),n.weeks.forEach(function(e,i){t.save(),t.font=r.weekStyle.fontWeight||" "+r.weekStyle.fontSize+"px "+t.fontFamily,t.fillStyle=r.weekStyle.color,t.fillText(e,o.x+n.weekWidth*i+n.weekWidth/2,o.y+n.monthHeight+n.weekHeight/2),t.restore()}),t.save(),t.font=r.dayStyle.fontWeight||" "+r.dayStyle.fontSize+"px "+t.fontFamily,t.fillStyle=r.dayStyle.color;var a=new Date(e,i-1,1),h=a.getDay();a.setMonth(i,0);for(var s=a.getDate(),l=[],c=0;c<6;c++)for(var d=0;d<7;d++){var f=7*c+d;if(!(f>=s+h)&&f>=h){var y=o.x+n.weekWidth*d,p=o.y+n.monthHeight+n.weekHeight+n.dayHeight*c;t.fillText(f-h+1,y+n.weekWidth/2,p+n.dayHeight/2),l.push({x:y,y:p})}}n.axisData.push(l),t.restore(),t.save(),t.beginPath(),t.strokeStyle=r.itemStyle.stroke,t.lineWidth=r.itemStyle.lineWidth,t.strokeRect(o.x,o.y,n.width,n.monthHeight);for(var g=0;g<7;g++)t.moveTo(o.x,o.y+n.monthHeight+n.weekHeight+n.dayHeight*g),t.lineTo(o.x+n.width,o.y+n.monthHeight+n.weekHeight+n.dayHeight*g);for(var m=0;m<8;m++)t.moveTo(o.x+n.weekWidth*m,o.y+n.monthHeight),t.lineTo(o.x+n.weekWidth*m,o.y+n.height);t.stroke(),t.closePath(),t.restore()},m.prototype.draw=function(t,e){for(var i=this.opts,o=0;o<i.rows;o++)for(var n=0;n<i.cols;n++){var r=o*i.cols+n+1,a={x:this.start.x+this.boxWidth*n,y:this.start.y+this.boxHeight*o};this.drawCalendar(t,e,r,a)}},m.prototype.getGrid=function(t,e){for(var i=this.gridData,o=0,n=i.length;o<n;o++){var r=i[o];if(t>=r.x&&t<r.x+r.w&&e>=r.y&&e<r.y+r.h)return r}return!1},m.prototype.convertGridData=function(t,e){var i=this,o=i.axisData,n=i.gridData=[],r=new f({width:e.width,height:e.height,min:e.min,max:e.max,gradient:e.gradient}),a=new y(e);return t.forEach(function(t,h){if(void 0!=t.date&&""!=t.date){var s=new RegExp("^[0-9]*$"),l=t.value,c=i.opts.itemStyle.fill,d="—";if(!s.test(l)||l<0)l="—";else if("continuous"===e.type)c=r.getColor(l),d=a.get(l).level;else{var f=a.get(l);c=f.color,d=f.level}var y=t.date.split("-");if(0!=y.length){var p=y[1],m=y[2],v=o[p-1][m-1].x,u=o[p-1][m-1].y,w=new g(h,v,u,i.dayWidth,i.dayHeight);w.centerx=v+i.dayWidth/2,w.centery=u+i.dayWidth/2,w.value=l,w.color=c,w.level=d,w.date=t.date,w.day=m,n.push(w)}}}),n},m.prototype.renderRect=function(t,e,i){var o=this,n=o.convertGridData(e,i),r=o.opts,a=o.dayWidth/2,h=o.dayHeight/2;t.save(),t.textAlign="center",t.textBaseline="middle",t.font=r.dayStyle.fontSize+"px "+t.fontFamily;for(var s=0,l=n.length;s<l;s++){var c=n[s];t.fillStyle=null==c.color?r.itemStyle.fill:c.color,t.fillRect(c.x,c.y,c.w,c.h),t.save(),t.fillStyle=r.dayStyle.color,t.fillText(c.day,c.x+parseInt(a),c.y+parseInt(h)),t.restore()}t.restore()},v.prototype.create=function(){var t=document.createElement("div");t.style.cssText=this.style,this.dom=t,this.container.appendChild(t)},v.prototype.setPosition=function(t,e){var i=this.dom,o=t-i.offsetWidth-this.opts.position[0],n=e-i.offsetHeight-this.opts.position[1];i.style.left=o+"px",i.style.top=n+"px"},v.prototype.setContent=function(t){this.dom.innerHTML=t},v.prototype.show=function(){this.dom.style.visibility="visible"},v.prototype.hide=function(){this.dom.style.visibility="hidden"},w.prototype.init=function(){var t=this,e=t.options;t.container=l(e);var i=t.backCanvas=u(e,!1),o=t.midCanvas=u(e,!0),n=t.foreCanvas=u(e,!0),r=t.view=new d({width:e.width,height:e.height,margin:e.viewCfg.margin}),a=t.legend=new p(e.legendCfg,r);a.draw(n.context);var h=new m(e.calendarCfg,r);h.draw(i.context,e.data.year),h.renderRect(o.context,this.options.data.days,a.options);var s=new v(t.container,e.toolTip);!function(){function t(){"click"===s.triggerOn?(n.canvasDOM.addEventListener("click",i,!1),s.dom.addEventListener("click",i,!1)):(n.canvasDOM.addEventListener("mousemove",i,!1),s.dom.addEventListener("mousemove",i,!1))}function e(t){a.save(),a.clearRect(h.start.x,h.start.y,h.viewWidth,h.viewHeight);var e=1;a.lineWidth=1,a.strokeStyle="#3c3c3c",a.strokeRect(Math.floor(t.x+e),Math.floor(t.y+e),Math.floor(t.w-1.1),Math.floor(t.h-1.1)),a.restore()}function i(t){var i=t.clientX-r.left,n=t.clientY-r.top,l=h.getGrid(i,n);if(l){if(o==l.i)return;if(o=l.i,e(l),s.isShow){var c=l.date+"<br>AQI : "+l.value+'<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+l.color+';"></span>'+l.level;s.setContent(c),s.setPosition(l.x,l.y),s.show()}}else a.clearRect(h.start.x,h.start.y,h.viewWidth,h.viewHeight),s.hide(),o=-1}var o=-1,r=n.canvasDOM.getBoundingClientRect(),a=n.context;t()}()},t.Calendar=w,Object.defineProperty(t,"__esModule",{value:!0})});