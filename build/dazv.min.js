!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Dazv=t.Dazv||{})}(this,function(t){"use strict";function e(t){var e="undefined"==typeof t?"undefined":L(t);return"function"===e||!!t&&"object"==e}function i(t){return"[object Array]"===k.call(t)}function o(t){return"object"===("undefined"==typeof t?"undefined":L(t))&&"number"==typeof t.nodeType&&"object"===L(t.ownerDocument)}function n(t){return!!C[k.call(t)]}function r(t){if(null==t||"object"!=("undefined"==typeof t?"undefined":L(t)))return t;var e=t,i=k.call(t);if("[object Array]"===i){e=[];for(var n=0,s=t.length;n<s;n++)e[n]=r(t[n])}else if(D[i])e=t.constructor.from(t);else if(!C[i]&&!o(t)){e={};for(var a in t)t.hasOwnProperty(a)&&(e[a]=r(t[a]))}return e}function s(t,a,h){if(!e(a)||!e(t))return h?r(a):t;for(var l in a)if(a.hasOwnProperty(l)){var c=t[l],d=a[l];!e(d)||!e(c)||i(d)||i(c)||o(d)||o(c)||n(d)||n(c)?!h&&l in t||(t[l]=r(a[l],!0)):s(c,d,h)}return t}function a(t){var e={};return t=t||"v",e[t]?e[t]+=1:e[t]=1,t+e[t]}function h(){return document.createElement("div")}function l(t,e){var i=e.wn,o=e.es;return t.x>=i.x&&t.x<=o.x&&t.y>=i.y&&t.y<=o.y}function c(t,e,i){var o=d(t,e);return o<=i}function d(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function f(t){var e,i=t.id,o=document.getElementById(i);if(!o&&!e)throw new Error("please specify the canvas container Id !");if(o&&e)throw new Error('please specify the "container" or "id" property !');if(!e){var n=T.guid("v-chart");t.container=e=T.createDiv(),e.id=n,e.style.position="relative",o.appendChild(e)}return e}function p(t){this.width=t.width,this.height=t.height,this.containerDOM=t.container,this.fontFamily=t.fontFamily,this.init()}function y(t){var e=t.margin;this.start={x:e[3],y:e[0]},this.end={x:t.width-e[1],y:t.height-e[2]},this.width=this.end.x-this.start.x,this.height=this.end.y-this.start.y}function g(t){t=t||{},this.gradient=t.gradient||{.1:"#fe0000",.4:"#ffaa01",.7:"#b0e000",1:"#38a702"},this.width=t.width||1,this.height=t.height||256,this.min=t.min||0,this.max=t.max||300,this.init()}function v(t){this.options=t,this.splitList=t.splitList||{},this.type=t.type||"continuous",this.calculable=t.calculable,this.init()}function u(t,e){this.options=t,this.init(e)}function x(t,e,i,o,n){this.i=t,this.x=e,this.y=i,this.w=o,this.h=n}function m(t,e){this.opts=t,this.width=e.width,this.height=e.height,this.start=e.start,this.end=e.end,this.gridWidth=(this.width-t.cols*t.space)/t.cols,this.gridHeight=(this.height-t.rows*t.space)/t.rows,this.createAxisData()}function w(t,e){this.opts=e,this.container=t,this.style=e.style,this.isShow=e.isShow,this.create()}function b(t){t=t||{},this.options=T.merge(W,t,!0),this.init()}function S(t,e){var i=new p({width:t.width,height:t.height,container:t.container,fontFamily:t.fontFamily});return e&&i.addTopLeft(),i}var L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},D={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},k=Object.prototype.toString,T={merge:s,guid:a,createDiv:h,isPointInRect:l,isPointInCircle:c,getDistance:d},W={width:1e3,height:500,fontSize:12,fontFamily:'"Helvetica Neue",Helvetica,"Hiragino Sans GB","STHeitiSC-LIght","Microsoft YaHei","微软雅黑",Arial,sans-serif',viewCfg:{margin:[20,60,60,60]},axisCfg:{line:{lineWidth:1,stroke:"#ccc",fill:"#f1f1f1"},labels:{fontSize:12,fill:"#3c3c3c"},title:{fontSize:12,fill:"#999"},tickLine:{lineWidth:1,stroke:"#ccc",value:5},titleOffset:42,lableOffset:10,grid:{line:{lineWidth:1,stroke:"#d9d9d9"}},gridAlign:"start",x:{type:"date",name:"日期（day）",min:0,max:31,showLine:!1,tickInterval:1},y:{type:"month",name:"月份（month）",min:0,max:12,showLine:!1,tickInterval:1},rows:12,cols:31,space:0,isIntersect:!0},calendarCfg:{rows:3,cols:4,margin:[0,10,8,0],monthStyle:{height:21,fontSize:12,fontWeight:"bold",fill:"#f7f7f7",color:"#666"},weekStyle:{height:21,fontSize:12,fill:"#fff",color:"#999"},dayStyle:{fontSize:12,stroke:"#ccc",color:"#3c3c3c"},itemStyle:{stroke:"#eee",fill:"#ddd",lineWidth:.5}},legendCfg:{show:!0,type:"piecewise",min:0,max:300,width:13,height:180,textGap:10,selectedMode:"multiple",itemSymbol:"circle",itemWidth:20,itemHeight:10,itemGap:14,wordSpaceing:8,left:15,bottom:5,calculable:!0,textStyle:{fontSize:12,color:"#3c3c3c"},gradient:{.1:"#fe0000",.2:"#ff3801",.3:"#ff7300",.4:"#ffaa01",.5:"#fae200",.6:"#e5f500",.7:"#b0e000",.8:"#84cf00",.9:"#5aba00",1:"#38a702"},splitList:[{start:0,end:50,color:"#00E400",level:"优"},{start:50,end:100,color:"#FFFF00",level:"良"},{start:100,end:150,color:"#FF7E00",level:"轻度污染"},{start:150,end:200,color:"#FF0000",level:"中度污染"},{start:200,end:300,color:"#99004C",level:"重度污染"},{start:300,color:"#7E0023",level:"严重污染"}]},toolTip:{isShow:!0,position:[5,5],style:"position:absolute;visibility:hidden;background-Color:rgba(0,0,0,0.7);transition:top 0.2s,left 0.2s;border-radius: 2px;color:#fff;line-height: 16px;padding:5px 10px;"}};p.prototype.init=function(){var t=this.containerDOM.childNodes.length,e=document.createElement("canvas"),i=e.getContext("2d");e.id="canvas_"+(t+1),e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.containerDOM.appendChild(e),this.canvasDOM=e,i.fontFamily=this.fontFamily,i.textAlign="center",i.textBaseline="middle",this.context=i},p.prototype.addTopLeft=function(){var t=this.canvasDOM;t.style.position="absolute",t.style.top=0,t.style.left=0},g.prototype.init=function(){var t=this.gradient,e=document.createElement("canvas");e.width=this.width,e.height=this.height;var i=this.context=e.getContext("2d"),o=i.createLinearGradient(0,0,e.width,e.height);for(var n in t)o.addColorStop(parseFloat(n),t[n]);i.fillStyle=o,i.fillRect(0,0,e.width,e.height)},g.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},g.prototype.getColor=function(t){var e=this.max;t>e&&(e=t);var i=4*Math.floor((e-t)/e*(this.height-1)),o=this.context.getImageData(0,0,1,this.height).data;return"rgba("+o[i]+", "+o[i+1]+", "+o[i+2]+", 1)"},v.prototype.init=function(){if("piecewise"==this.type&&this.calculable)for(var t=new g(this.options),e=this.splitList,i=0;i<e.length;i++)e[i].color=t.getColor(e[i].start)},v.prototype.get=function(t){for(var e=this.splitList,i=!1,o=0;o<e.length;o++)if((void 0===e[o].start||void 0!==e[o].start&&t>e[o].start)&&(void 0===e[o].end||void 0!==e[o].end&&t<=e[o].end)){i=e[o];break}return i};var H=function(t){t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)};u.prototype.init=function(t){var e=this.options;this.start={x:t.end.x+e.left,y:t.end.y-e.bottom-e.height-e.textGap},this.end={x:t.end.x+e.left+e.width,y:t.end.y-e.bottom-e.textGap}},u.prototype.draw=function(t){if(this.options.show)switch(this.options.type){case"piecewise":this.renderByPieceWise(t);break;default:this.renderByContinuous(t)}},u.prototype.renderByContinuous=function(t){var e=this.options,i=new g({width:e.width,height:e.height,min:e.min,max:e.max,gradient:e.gradient});t.putImageData(i.getImageData(),this.start.x,this.start.y),t.save(),t.font=e.textStyle.fontSize+"px "+t.fontFamily,t.fillStyle=e.textStyle.color,t.textAlign="center",t.textBaseline="middle",t.fillText(e.max,this.start.x+e.width/2,this.start.y-e.textGap),t.fillText(e.min,this.start.x+e.width/2,this.end.y+e.textGap),t.restore()},u.prototype.renderByPieceWise=function(t){var e=this;e.initLevel(),e.drawSymbol(t)},u.prototype.initLevel=function(){var t=(new v(this.options),this.options),e=this.levels=[],i=0;"circle"===t.itemSymbol&&(i=t.itemHeight/2,t.itemWidth=0);for(var o=0;o<t.splitList.length;o++){var n=t.splitList[o];e.push({x:this.start.x+i,y:this.end.y-t.itemHeight*o-t.itemGap*o+i,fontX:this.start.x+2*i+t.itemWidth+t.wordSpaceing,fontY:this.end.y-t.itemHeight*o-t.itemGap*o,start:n.start,end:n.end,text:n.level,color:n.color,hideColor:"#ccc",show:!0})}},u.prototype.drawSymbol=function(t){var e=this.options;this.levels.forEach(function(i,o){switch(t.beginPath(),t.fillStyle=i.show?i.color:i.hideColor,e.itemSymbol){case"circle":t.arc(i.x,i.y,e.itemHeight/2,0,2*Math.PI);break;case"rect":t.rect(i.x,i.y,e.itemWidth,e.itemHeight);break;case"roundRect":var n=3;t.moveTo(i.x+n,i.y),t.arcTo(i.x+e.itemWidth,i.y,i.x+e.itemWidth,i.y+e.itemHeight,n),t.arcTo(i.x+e.itemWidth,i.y+e.itemHeight,i.x,i.y+e.itemHeight,n),t.arcTo(i.x,i.y+e.itemHeight,i.x,i.y,n),t.arcTo(i.x,i.y,i.x+n,i.y,n)}t.fill(),t.closePath(),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+t.fontFamily,i.fontWidth=t.measureText(i.text).width,i.fontHeight=e.textStyle.fontSize<12?12:e.textStyle.fontSize,t.fillStyle=i.show?e.textStyle.color:i.hideColor,t.fillText(i.text,i.fontX,i.fontY+i.fontHeight/2),t.restore()})},u.prototype.getLevel=function(t){for(var e,i,o=this.options,n=this.levels,r=0,s=n.length;r<s;r++){var a=n[r];switch(o.itemSymbol){case"circle":var h={x:a.x,y:a.y};e=T.isPointInCircle(t,h,o.itemHeight/2);break;default:var l={wn:{x:a.x,y:a.y},es:{x:a.x+o.itemWidth,y:a.y+o.itemHeight}};e=T.isPointInRect(t,l)}if(i=T.isPointInRect(t,{wn:{x:a.fontX,y:a.fontY},es:{x:a.fontX+a.fontWidth,y:a.fontY+a.fontHeight}}),e||i)return a}},u.prototype.updateSelectedList=function(t){return this.selectedList=this.selectedList||this.levels.slice(),t.show?this.selectedList.push(t):this.selectedList.remove(t),this.selectedList},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)},u.prototype.move=function(t,e){this.getLevel(t)?e.style.cursor="pointer":e.style.cursor="default"},m.prototype.createAxisData=function(){for(var t=this.axisData=[],e=0;e<this.opts.cols;e++){for(var i=[],o=0;o<this.opts.rows;o++)i.push({x:this.start.x+this.gridWidth*e+this.opts.space*(e+1),y:this.start.y+this.gridHeight*o+this.opts.space*o});t.push(i)}return t},m.prototype.draw=function(t){this.drawAxis(t),this.drawTickLine(t),this.opts.isIntersect?this.drawRectIntersect(t):this.drawGridRect(t),this.drawTitle(t)},m.prototype.drawAxis=function(t){t.beginPath(),t.lineWidth=this.opts.line.lineWidth,t.strokeStyle=this.opts.line.stroke,t.moveTo(this.start.x,this.start.y),t.lineTo(this.start.x,this.end.y),t.lineTo(this.end.x,this.end.y),t.stroke()},m.prototype.drawTickLine=function(t){var e=this.opts,i=this.axisData,o=this.gridWidth/2,n=this.gridHeight/2;t.save(),t.beginPath(),t.lineWidth=e.tickLine.lineWidth,t.strokeStyle=e.tickLine.stroke;for(var r=1;r<=i.length;r++){var s=i[r-1][i[r-1].length-1],a=s.x+o,h=this.end.y;t.moveTo(a,h),t.lineTo(a,h+e.tickLine.value),this.drawLabel(t,r,a,h+e.lableOffset,!0)}for(var l=i[0].length;l>0;l--){var c=i[0][i[0].length-l],a=this.start.x,h=c.y+n;t.moveTo(a,h),t.lineTo(a-e.tickLine.value,h),this.drawLabel(t,l+"月",a-e.lableOffset,h,!1)}t.stroke(),t.restore()},m.prototype.drawLabel=function(t,e,i,o,n){t.save(),t.font=this.opts.labels.fontSize+"px "+t.fontFamily,t.fillStyle=this.opts.labels.fill,n?(t.textAlign="center",t.textBaseline="top",t.fillText(e,i,o)):(t.textAlign="right",t.textBaseline="middle",t.fillText(e,i,o)),t.restore()},m.prototype.drawTitle=function(t){var e=this.opts;t.save(),t.font=e.title.fontSize+"px "+t.fontFamily,t.fillStyle=e.title.fill,t.save(),t.textAlign="center",t.textBaseline="top",t.fillText("日期（day）",this.start.x+this.width/2,this.end.y+e.titleOffset),t.restore(),t.translate(this.start.x-e.titleOffset,this.end.y-this.height/2),t.rotate(-Math.PI/2),t.fillText("月份（month）",0,0),t.restore()},m.prototype.drawGridRect=function(t){var e=this.axisData;t.beginPath(),t.save(),t.fillStyle=this.opts.line.fill;for(var i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++){var n=e[i][o];t.rect(n.x,n.y,this.gridWidth,this.gridHeight)}t.fill(),t.restore()},m.prototype.drawRectIntersect=function(t){var e=this.axisData;t.beginPath(),t.save();for(var i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++){i%2==0&&o%2==0||i%2!=0&&o%2!=0?t.fillStyle="#f9f9f9":t.fillStyle=this.opts.line.fill;var n=e[i][o];t.fillRect(n.x,n.y,this.gridWidth,this.gridHeight)}t.restore()},m.prototype.getGrid=function(t){for(var e=this.gridData,i=0,o=e.length;i<o;i++){var n=e[i];if(t.x>=n.x&&t.x<n.x+n.w&&t.y>=n.y&&t.y<n.y+n.h)return n}return!1},m.prototype.convertGridData=function(t,e){var i=this;t=t.length>i.opts.cols*i.opts.rows?t.slice(0,i.opts.cols*i.opts.rows):t;var o=i.axisData,n=i.gridData=[],r=new g({width:e.width,height:e.height,min:e.min,max:e.max,gradient:e.gradient}),s=new v(e);return t.forEach(function(t,a){if(void 0!=t.date&&""!=t.date){var h=new RegExp("^[0-9]*$"),l=t.value,c=i.opts.line.fill,d="—";if(!h.test(l)||l<0)l="—";else if("continuous"===e.type)c=r.getColor(l),d=s.get(l).level;else{var f=s.get(l);c=f.color,d=f.level}var p=t.date.split("-");if(0!=p.length&&!(p[1]>i.opts.rows)){var y=p[1],g=p[2],v=o[g-1][i.opts.rows-y].x,u=o[g-1][i.opts.rows-y].y,m=new x(a,v,u,i.gridWidth,i.gridHeight);m.centerx=v+i.gridWidth/2,m.centery=u+i.gridWidth/2,m.value=l,m.color=c,m.level=d,m.date=t.date,n.push(m)}}}),n},m.prototype.render=function(t,e,i){this.gridData=this.convertGridData(e,i),this.drawRect(t,this.gridData)},m.prototype.drawRect=function(t,e){var i=this,o=i.opts,n=i.gridWidth/2,r=i.gridWidth/2;H(t),t.save(),t.font=o.labels.fontSize+"px "+t.fontFamily,e.forEach(function(e,i){t.fillStyle=null==e.color?o.itemStyle.fill:e.color,t.fillRect(e.x,e.y,e.w,e.h),t.save(),t.fillStyle=o.labels.fill,t.fillText(e.value,e.x+n,e.y+r),t.restore()}),t.restore()},m.prototype.removeData=function(t){var e=[];return this.gridData.forEach(function(i,o){t.forEach(function(t,o){(void 0===t.start||void 0!==t.start&&i.value>t.start)&&(void 0===t.end||void 0!==t.end&&i.value<=t.end)&&e.push(i)})}),e},w.prototype.create=function(){var t=document.createElement("div");t.style.cssText=this.style,this.dom=t,this.container.appendChild(t)},w.prototype.setPosition=function(t,e){var i=this.dom,o=t-i.offsetWidth-this.opts.position[0],n=e-i.offsetHeight-this.opts.position[1];i.style.left=o+"px",i.style.top=n+"px"},w.prototype.setContent=function(t){this.dom.innerHTML=t},w.prototype.show=function(){this.dom.style.visibility="visible"},w.prototype.hide=function(){this.dom.style.visibility="hidden"},b.prototype.init=function(){var t=this,e=t.options;t.container=f(e);var i=t.backCanvas=S(e,!1),o=t.midCanvas=S(e,!0),n=t.foreCanvas=S(e,!0),r=t.view=new y({width:e.width,height:e.height,margin:e.viewCfg.margin}),s=t.legend=new u(e.legendCfg,r);s.draw(n.context);var a=new m(e.axisCfg,r);a.draw(i.context),a.render(o.context,this.options.data,s.options);var h=new w(t.container,e.toolTip);!function(){function t(){n.canvasDOM.addEventListener("mousemove",i,!1),n.canvasDOM.addEventListener("click",l,!1),h.dom.addEventListener("mousemove",i,!1)}function e(t){f.save(),f.clearRect(a.start.x,a.start.y,a.width,a.height);var e=1;f.lineWidth=1,f.strokeStyle="#3c3c3c",f.strokeRect(Math.floor(t.x+e),Math.floor(t.y+e),Math.floor(t.w-1.1),Math.floor(t.h-1.1)),f.restore()}function i(t){t.stopPropagation();var i={x:t.clientX-d.left,y:t.clientY-d.top};r(i);var o=a.getGrid(i);if(o){if(c==o.i)return;if(c=o.i,e(o),h.isShow){var n=o.date+"<br>AQI : "+o.value+'<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+o.color+';"></span>'+o.level;h.setContent(n),h.setPosition(o.x,o.y),h.show()}}else f.clearRect(a.start.x,a.start.y,a.width,a.height),h.hide(),c=-1}function r(t){"piecewise"===s.options.type&&s.move(t,n.canvasDOM)}function l(t){t.stopPropagation();var e={x:t.clientX-d.left,y:t.clientY-d.top};if("piecewise"===s.options.type){var i=s.getLevel(e);if(i){H(f),i.show=!i.show,s.drawSymbol(f);var n=s.updateSelectedList(i),r=a.removeData(n);a.drawRect(o.context,r)}}}var c=-1,d=n.canvasDOM.getBoundingClientRect(),f=n.context;t()}()},t.Chart=b,Object.defineProperty(t,"__esModule",{value:!0})});