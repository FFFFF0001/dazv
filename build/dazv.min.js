!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Dazv=t.Dazv||{})}(this,function(t){"use strict";function e(t){var e={};return t=t||"v",e[t]?e[t]+=1:e[t]=1,t+e[t]}function i(){return document.createElement("div")}function o(t){return t&&t.length?Array.prototype.slice.call(t):[]}function r(){var t=this.toArray(arguments),e=t[0];if(e!==!0){for(var i=1;i<t.length;i++){var o=t[i];for(var n in o)o.hasOwnProperty(n)&&"constructor"!==n&&(e[n]=o[n])}return e}e=t[1];for(var i=2;i<t.length;i++){var o=t[i];a(e,o)}}function a(t,e,i){var o=5;i=i||0;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];null!==a&&s.isObject(a)?(s.isObject(t[r])||(t[r]={}),i<o?n(t[r],e[r],i+1):t[r]=e[r]):s.isArray(a)?(t[r]=[],t[r]=t[r].concat(a)):void 0!==a&&(t[r]=e[r])}}function l(t){var e,i=t.id,o=document.getElementById(i);if(!o&&!e)throw new Error("please specify the canvas container Id !");if(o&&e)throw new Error('please specify the "container" or "id" property !');if(!e){var n=w.guid("v-chart");t.container=e=w.createDiv(),e.id=n,e.style.position="relative",o.appendChild(e)}return e}function h(t){this.width=t.width,this.height=t.height,this.containerDOM=t.container,this.fontFamily=t.fontFamily,this.init()}function d(t){var e=t.margin;this.start={x:e[3],y:e[0]},this.end={x:t.width-e[1],y:t.height-e[2]},this.width=this.end.x-this.start.x,this.height=this.end.y-this.start.y}function c(t){t=t||{},this.gradient=t.gradient||{.1:"#fe0000",.4:"#ffaa01",.7:"#b0e000",1:"#38a702"},this.width=t.width||1,this.height=t.height||256,this.min=t.min||0,this.max=t.max||300,this.init()}function f(t){this.options=t,this.splitList=t.splitList||{},this.type=t.type||"continuous",this.calculable=t.calculable,this.init()}function p(t,e){this.options=t,this.init(e)}function g(t,e,i,o,n){this.i=t,this.x=e,this.y=i,this.w=o,this.h=n}function y(t,e){this.opts=t,this.width=e.width,this.height=e.height,this.start=e.start,this.end=e.end,this.gridWidth=(this.width-t.cols*t.space)/t.cols,this.gridHeight=(this.height-t.rows*t.space)/t.rows,this.createAxisData()}function v(t,e){this.opts=e,this.container=t,this.style=e.style,this.isShow=e.isShow,this.triggerOn=e.triggerOn,this.create()}function m(t){var e=this;t=t||{},e.options=w.mix({},S,t),e.init()}function u(t,e){var i=new h({width:t.width,height:t.height,container:t.container,fontFamily:t.fontFamily});return e&&i.addTopLeft(),i}var x="1.0.0",w={guid:e,createDiv:i,mix:r,toArray:o},S={width:1e3,height:500,fontSize:12,fontFamily:'"Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", SimSun, "sans-serif"',viewCfg:{margin:[20,60,60,60]},axisCfg:{line:{lineWidth:1,stroke:"#ccc",fill:"#f1f1f1"},labels:{fontSize:12,fill:"#3c3c3c"},title:{fontSize:12,fill:"#999"},tickLine:{lineWidth:1,stroke:"#ccc",value:5},titleOffset:42,lableOffset:10,grid:{line:{lineWidth:1,stroke:"#d9d9d9"}},gridAlign:"start",x:{type:"date",name:"日期（day）",min:0,max:31,showLine:!1,tickInterval:1},y:{type:"month",name:"月份（month）",min:0,max:12,showLine:!1,tickInterval:1},rows:12,cols:31,space:0,isIntersect:!0},legendCfg:{show:!0,type:"piecewise",min:0,max:300,width:13,height:180,textGap:10,selectedMode:"multiple",itemSymbol:"circle",itemWidth:20,itemHeight:10,itemGap:14,wordSpaceing:8,left:15,bottom:5,calculable:!0,textStyle:{fontSize:12,fontFamily:'"Microsoft YaHei", "微软雅黑", SimSun, "sans-serif"',color:"#3c3c3c"},gradient:{.1:"#fe0000",.2:"#ff3801",.3:"#ff7300",.4:"#ffaa01",.5:"#fae200",.6:"#e5f500",.7:"#b0e000",.8:"#84cf00",.9:"#5aba00",1:"#38a702"},splitList:[{start:0,end:50,color:"#00E400",level:"优"},{start:50,end:100,color:"#FFFF00",level:"良"},{start:100,end:150,color:"#FF7E00",level:"轻度污染"},{start:150,end:200,color:"#FF0000",level:"中度污染"},{start:200,end:300,color:"#99004C",level:"重度污染"},{start:300,color:"#7E0023",level:"严重污染"}]},toolTip:{isShow:!0,position:[5,5],triggerOn:"mousemove",style:"position:absolute;visibility:hidden;background-Color:rgba(0,0,0,0.7);transition:top 0.2s,left 0.2s;border-radius: 2px;color:#fff;line-height: 16px;padding:5px 10px;"}};h.prototype.init=function(){var t=this.containerDOM.childNodes.length,e=document.createElement("canvas"),i=e.getContext("2d");e.id="canvas_"+(t+1),e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.containerDOM.appendChild(e),this.canvasDOM=e,i.fontFamily=this.fontFamily,this.context=i},h.prototype.addTopLeft=function(){var t=this.canvasDOM;t.style.position="absolute",t.style.top=0,t.style.left=0},c.prototype.init=function(){var t=this.gradient,e=document.createElement("canvas");e.width=this.width,e.height=this.height;var i=this.context=e.getContext("2d"),o=i.createLinearGradient(0,0,e.width,e.height);for(var n in t)o.addColorStop(parseFloat(n),t[n]);i.fillStyle=o,i.fillRect(0,0,e.width,e.height)},c.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},c.prototype.getColor=function(t){var e=this.max;t>e&&(e=t);var i=4*Math.floor((e-t)/e*(this.height-1)),o=this.context.getImageData(0,0,1,this.height).data;return"rgba("+o[i]+", "+o[i+1]+", "+o[i+2]+", 1)"},f.prototype.init=function(){if("piecewise"==this.type&&this.calculable)for(var t=new c(this.options),e=this.splitList,i=0;i<e.length;i++)e[i].color=t.getColor(e[i].start)},f.prototype.get=function(t){for(var e=this.splitList,i=!1,o=0;o<e.length;o++)if((void 0===e[o].start||void 0!==e[o].start&&t>e[o].start)&&(void 0===e[o].end||void 0!==e[o].end&&t<=e[o].end)){i=e[o];break}return i},p.prototype.init=function(t){var e=this.options;this.start={x:t.end.x+e.left,y:t.end.y-e.bottom-e.height-e.textGap},this.end={x:t.end.x+e.left+e.width,y:t.end.y-e.bottom-e.textGap}},p.prototype.draw=function(t){if(this.options.show)switch(this.options.type){case"piecewise":this.drawByPieceWise(t);break;default:this.drawByContinuous(t)}},p.prototype.drawByContinuous=function(t){var e=this.options,i=new c({width:e.width,height:e.height,min:e.min,max:e.max,gradient:e.gradient});t.putImageData(i.getImageData(),this.start.x,this.start.y),t.save(),t.font=e.textStyle.fontSize+"px "+e.textStyle.fontFamily,t.fillStyle=e.textStyle.color,t.textAlign="center",t.textBaseline="middle",t.fillText(e.max,this.start.x+e.width/2,this.start.y-e.textGap),t.fillText(e.min,this.start.x+e.width/2,this.end.y+e.textGap),t.restore()},p.prototype.drawByPieceWise=function(t){new f(this.options);switch(this.options.itemSymbol){case"circle":this.drawCircle(t);break;case"rect":this.drawRect(t);break;case"roundRect":this.drawRoundRect(t)}},p.prototype.drawCircle=function(t){for(var e=this.options,i=e.itemHeight/2,o=0;o<e.splitList.length;o++){var n=e.splitList[o],s=this.start.x+i,r=this.end.y-e.itemHeight*o-e.itemGap*o-i;t.fillStyle=n.color,t.beginPath(),t.arc(s,r,i,0,2*Math.PI,!0),t.closePath(),t.fill(),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+e.textStyle.fontFamily,t.fillStyle=e.textStyle.color,t.fillText(n.level,s+i+e.wordSpaceing,r),t.restore()}},p.prototype.drawRect=function(t){for(var e=this.options,i=e.itemHeight/2,o=0;o<e.splitList.length;o++){var n=e.splitList[o],s=this.start.x,r=this.end.y-e.itemHeight*(o+1)-e.itemGap*o;t.fillStyle=n.color,t.fillRect(s,r,e.itemWidth,e.itemHeight),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+e.textStyle.fontFamily,t.fillStyle=e.textStyle.color,t.fillText(n.level,s+e.itemWidth+e.wordSpaceing,r+i),t.restore()}},p.prototype.drawRoundRect=function(t){for(var e=this.options,i=e.itemHeight/2,o=3,n=0;n<e.splitList.length;n++){var s=e.splitList[n],r=this.start.x,a=this.end.y-e.itemHeight*(n+1)-e.itemGap*n;t.fillStyle=s.color,t.beginPath(),t.moveTo(r+o,a),t.arcTo(r+e.itemWidth,a,r+e.itemWidth,a+e.itemHeight,o),t.arcTo(r+e.itemWidth,a+e.itemHeight,r,a+e.itemHeight,o),t.arcTo(r,a+e.itemHeight,r,a,o),t.arcTo(r,a,r+o,a,o),t.closePath(),t.fill(),t.save(),t.textAlign="left",t.textBaseline="middle",t.font=e.textStyle.fontSize+"px "+e.textStyle.fontFamily,t.fillStyle=e.textStyle.color,t.fillText(s.level,r+e.itemWidth+e.wordSpaceing,a+i),t.restore()}},p.prototype.getTextWidthHeight=function(t){var e=document.createElement("span"),i=this.options;e.style.font=i.textStyle.fontSize+"px "+i.textStyle.fontFamily,e.innerText=t,document.body.appendChild(e);var o={width:e.offsetWidth,height:e.offsetHeight};return document.body.removeChild(e),o},Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e){var i=t[e];window.requestAnimationFrame=window[i+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var o=0;window.requestAnimationFrame=function(t){var e=Date.now(),i=Math.max(o+16,e);return setTimeout(function(){t(o=i)},i-e)},window.cancelAnimationFrame=clearTimeout}}(),y.prototype.createAxisData=function(){for(var t=this.axisData=[],e=0;e<this.opts.cols;e++){for(var i=[],o=0;o<this.opts.rows;o++)i.push({x:this.start.x+this.gridWidth*e+this.opts.space*(e+1),y:this.start.y+this.gridHeight*o+this.opts.space*o});t.push(i)}return t},y.prototype.draw=function(t){this.drawAxis(t),this.drawTickLine(t),this.opts.isIntersect?this.drawRectIntersect(t):this.drawGridRect(t),this.drawTitle(t)},y.prototype.drawAxis=function(t){t.beginPath(),t.lineWidth=this.opts.line.lineWidth,t.strokeStyle=this.opts.line.stroke,t.moveTo(this.start.x,this.start.y),t.lineTo(this.start.x,this.end.y),t.lineTo(this.end.x,this.end.y),t.stroke()},y.prototype.drawTickLine=function(t){var e=this.opts,i=this.axisData,o=this.gridWidth/2,n=this.gridHeight/2;t.save(),t.beginPath(),t.lineWidth=e.tickLine.lineWidth,t.strokeStyle=e.tickLine.stroke;for(var s=1;s<=i.length;s++){var r=i[s-1][i[s-1].length-1],a=r.x+o,l=this.end.y;t.moveTo(a,l),t.lineTo(a,l+e.tickLine.value),this.drawLabel(t,s,a,l+e.lableOffset,!0)}for(var h=i[0].length;h>0;h--){var d=i[0][i[0].length-h],a=this.start.x,l=d.y+n;t.moveTo(a,l),t.lineTo(a-e.tickLine.value,l),this.drawLabel(t,h+"月",a-e.lableOffset,l,!1)}t.stroke(),t.restore()},y.prototype.drawLabel=function(t,e,i,o,n){t.save(),t.font=this.opts.labels.fontSize+"px "+t.fontFamily,t.fillStyle=this.opts.labels.fill,n?(t.textAlign="center",t.textBaseline="top",t.fillText(e,i,o)):(t.textAlign="right",t.textBaseline="middle",t.fillText(e,i,o)),t.restore()},y.prototype.drawTitle=function(t){var e=this.opts;t.save(),t.font=e.title.fontSize+"px "+t.fontFamily,t.fillStyle=e.title.fill,t.save(),t.textAlign="center",t.textBaseline="top",t.fillText("日期（day）",this.start.x+this.width/2,this.end.y+e.titleOffset),t.restore(),t.translate(this.start.x-e.titleOffset,this.end.y-this.height/2),t.rotate(-Math.PI/2),t.fillText("月份（month）",0,0),t.restore()},y.prototype.drawGridRect=function(t){var e=this.axisData;t.beginPath(),t.save(),t.fillStyle=this.opts.line.fill;for(var i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++){var n=e[i][o];t.rect(n.x,n.y,this.gridWidth,this.gridHeight)}t.fill(),t.restore()},y.prototype.drawRectIntersect=function(t){var e=this.axisData;t.beginPath(),t.save();for(var i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++){i%2==0&&o%2==0||i%2!=0&&o%2!=0?t.fillStyle="#f9f9f9":t.fillStyle=this.opts.line.fill;var n=e[i][o];t.fillRect(n.x,n.y,this.gridWidth,this.gridHeight)}t.restore()},y.prototype.getGrid=function(t,e){for(var i=this.gridData,o=0,n=i.length;o<n;o++){var s=i[o];if(t>=s.x&&t<s.x+this.gridWidth&&e>=s.y&&e<s.y+this.gridHeight)return s}return!1},y.prototype.convertGridData=function(t,e){var i=this,o=e;t=t.length>i.opts.cols*i.opts.rows?t.slice(0,i.opts.cols*i.opts.rows):t;var n=this.axisData,s=this.gridData=[],r=new c({width:o.width,height:o.height,min:o.min,max:o.max,gradient:o.gradient}),a=new f(o);return t.forEach(function(t,e){if(void 0!=t.date&&""!=t.date){var l=new RegExp("^[0-9]*$"),h=t.value,d=i.opts.line.fill,c="—";if(!l.test(h)||h<0)h="—";else if("continuous"===o.type)d=r.getColor(h),c=a.get(h).level;else{var f=a.get(h);d=f.color,c=f.level}var p=t.date.split("-");if(0!=p.length&&!(p[1]>i.opts.rows)){var y=p[1],v=p[2],m=n[v-1][i.opts.rows-y].x,u=n[v-1][i.opts.rows-y].y,x=new g(e,m,u,i.gridWidth,i.gridHeight);x.centerx=m+i.gridWidth/2,x.centery=u+i.gridWidth/2,x.value=h,x.color=d,x.level=c,x.date=t.date,s.push(x)}}}),s},y.prototype.renderRect=function(t,e,i){var o=this.convertGridData(e,i),n=this.opts,s=this.gridWidth/2,r=this.gridHeight/2;t.save(),t.textAlign="center",t.textBaseline="middle";for(var a=0,l=o.length;a<l;a++){var h=o[a];t.fillStyle=null==h.color?n.line.fill:h.color,t.fillRect(h.x,h.y,this.gridWidth,this.gridHeight),t.save(),t.font=n.labels.fontSize+"px "+t.fontFamily,t.fillStyle=n.labels.fill,t.fillText(h.value,h.x+parseInt(s),h.y+parseInt(r)),t.restore()}t.restore()},v.prototype.create=function(){var t=document.createElement("div");t.style.cssText=this.style,this.dom=t,this.container.appendChild(t)},v.prototype.setPosition=function(t,e){var i=this.dom,o=t-i.offsetWidth-this.opts.position[0],n=e-i.offsetHeight-this.opts.position[1];i.style.left=o+"px",i.style.top=n+"px"},v.prototype.setContent=function(t){this.dom.innerHTML=t},v.prototype.show=function(){this.dom.style.visibility="visible"},v.prototype.hide=function(){this.dom.style.visibility="hidden"},m.prototype.init=function(){var t=this,e=t.options;t.container=l(e);var i=t.backCanvas=u(e,!1),o=t.midCanvas=u(e,!0),n=t.foreCanvas=u(e,!0),s=t.view=new d({width:e.width,height:e.height,margin:e.viewCfg.margin}),r=t.legend=new p(e.legendCfg,s),a=new y(e.axisCfg,s);a.draw(i.context),a.renderRect(o.context,this.options.data,r.options);var h=new v(t.container,e.toolTip);!function(){function t(){"click"===h.triggerOn?(n.canvasDOM.addEventListener("click",i,!1),h.dom.addEventListener("click",i,!1)):(n.canvasDOM.addEventListener("mousemove",i,!1),h.dom.addEventListener("mousemove",i,!1))}function e(t){l.save(),l.clearRect(a.start.x,a.start.y,a.width,a.height);var e=1;l.lineWidth=1,l.strokeStyle="#3c3c3c",l.strokeRect(Math.floor(t.x+e),Math.floor(t.y+e),Math.floor(t.w-1.1),Math.floor(t.h-1.1)),l.restore()}function i(t){var i=t.clientX-s.left,n=t.clientY-s.top,r=a.getGrid(i,n);if(r){if(o==r.i)return;if(o=r.i,e(r),h.isShow){var d=r.date+"<br>AQI : "+r.value+'<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+r.color+';"></span>'+r.level;h.setContent(d),h.setPosition(r.x,r.y),h.show()}}else l.clearRect(a.start.x,a.start.y,a.width,a.height),h.hide(),o=-1}var o=-1,s=n.canvasDOM.getBoundingClientRect(),l=n.context;r.draw(l),t()}()},m.prototype.get=function(t){return this[t]},t.version=x,t.Chart=m,Object.defineProperty(t,"__esModule",{value:!0})});